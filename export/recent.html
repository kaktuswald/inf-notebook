<!doctype html>
<html>
	<head>
		<meta charset='utf-8'/>
		<title>inf-notebook recent</title>
		<style>
body {
	background-color: rgba(0, 0, 0, 0);
	margin: 0px;
	overflow: hidden;
	font-size: 64px;
	color: rgba(128, 128, 128, 1);
	text-shadow: 1px 1px 0 rgba(0, 0, 0, 1),
				 -1px 1px 0 rgba(0, 0, 0, 1),
				 1px -1px 0 rgba(0, 0, 0, 1),
				 -1px -1px 0 rgba(0, 0, 0, 1);
}

div#played_count {
	font-size: 80px;
	color: rgba(192, 192, 255, 1);
}

p {
	margin: 0px;
}

span.new {
	color: rgba(192, 32, 32, 1);
}
		</style>
		<script src='./jquery-3.6.4.min.js'></script>
		<script>
filename = './recent.json'

function reflect(json)
{
	$('#played_count span').html(json.length)
	$('#played_musics').empty()
	json.reverse().forEach(item => {
		let newItem = $('<p>')
		if(item.new)
			newItem.append(`<span class='new'>(new!)</span>`)
		if(!isNaN(item.music))
			newItem.append(`<span>?????</span>`)
		else
			newItem.append(`<span>${item.music}</span>`)
		$('#played_musics').append(newItem)
	});

	$('#error').css('visibility', 'hidden')
	$('#normal').css('visibility', 'visible')
}

function error()
{
	$('#error').css('visibility', 'visible')
	$('#normal').css('visibility', 'hidden')
}

function load()
{
    fetch(filename, {cache: 'no-store'})
		.then(response => {
			if(response.ok)
				response.json().then(json => reflect(json));
			else
				error();
		});
}

$(function(){
	load();
});

window.addEventListener('DOMContentLoaded', function() {
	var roopTimer = setInterval(load, 1000);
});
		</script>
	</head>
	<body>
		<div id='normal' style='visibility: hidden'>
			<div id='played_count'>
				play count: 
				<span>0</span>
			</div>
			<div id='played_musics'></div>
		</div>
		<div id='error'>
			<span>データがありません。</span>
		</div>
	</body>
</html>
