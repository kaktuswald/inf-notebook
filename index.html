<!doctype html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>inf-notebook</title>
		<style>
body {
	background-color: rgba(0, 0, 0, 0);
	margin: 0px;
	overflow: hidden;
	font-size: 64px;
	color: rgba(128, 128, 128, 255);
	text-shadow: 1px 1px 0 rgba(0, 0, 0, 1),
				 -1px 1px 0 rgba(0, 0, 0, 1),
				 1px -1px 0 rgba(0, 0, 0, 1),
				 -1px -1px 0 rgba(0, 0, 0, 1);
}

div#recent_played_count {
	background-color: rgba(32, 128, 32, 0.05);
	font-size: 80px;
	color: rgba(192, 192, 255, 1);
}

p {
	margin: 0px;
}

span.new {
	color: rgba(255, 0, 0, 1);
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
filename = 'recent.json'

function reflect(json)
{
	$('#recent_played_count span').html(json.length)
	$('#recent_played_musics').empty()
	json.reverse().forEach(item => {
		let newItem = $('<p>')
		if(item.new)
			newItem.append(`<span class="new">(new!)</span>`)
		if(!isNaN(item.music))
			newItem.append(`<span>?????</span>`)
		else
			newItem.append(`<span>${item.music}</span>`)
		$('#recent_played_musics').append(newItem)
	});

	$('#error').css('visibility', 'hidden')
	$('#normal').css('visibility', 'visible')
}

function error()
{
	$('#error').css('visibility', 'visible')
	$('#normal').css('visibility', 'hidden')
}

function reload()
{
    fetch(filename, {cache: "no-store"})
		.then(response => {
			if(response.ok)
				response.json().then(json => reflect(json));
			else
				error();
		});
}

window.addEventListener('DOMContentLoaded', function() {
	var roopTimer = setInterval(reload, 1000);
});
	</script>
	</head>
	<body>
		<div id="normal" style="visibility: hidden">
			<div id="recent_played_count">
				play count: 
				<span>0</span>
			</div>
			<div id="recent_played_musics"></div>
		</div>
		<div id="error">
			<span>データがありません。</span>
		</div>
	</body>
</html>
